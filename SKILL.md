---
name: distill
description: |
  Distill completed work into reusable skills (SOP orchestration, Capability, or Tool types).

  PROACTIVELY suggest when ANY of these occur:
  - 3+ iteration cycles to solve a problem
  - Non-obvious tricks or hidden pitfalls discovered
  - Complex multi-step debugging completed
  - User expressed "finally got it", "oh that's why", "what a trap"
  - Problem is common enough to appear in other projects

  After such tasks, ask: "This took some iteration. Want me to /distill to extract a reusable skill?"

  Subcommands: /distill, /distill [focus], /distill advise [topic], /distill upload, /distill stats
---

# /distill - Extract Reusable Skills

## Command Routing

| Command | Action |
|---------|--------|
| `/distill` | Analyze current session, extract skill(s) |
| `/distill <text>` | Analyze with focus on `<text>` |
| `/distill advise [topic]` | Search existing skills for relevant knowledge before starting work |
| `/distill upload` | Upload skills to dstl.dev (see references/upload-guide.md) |
| `/distill stats` | Show status of all skills |

---

## Distill Flow

> **On start**: Use the **TaskCreate** tool (not TodoWrite) to create tasks for Steps 1-8. Use **TaskUpdate** to mark each as `in_progress` when starting, `completed` when done. Tasks persist in `~/.claude/tasks/` and survive context compaction.

### Step 1: Review Session [MUST]

Identify from the current session:
- **Problem**: What was the original problem?
- **Failed attempts**: What didn't work and why? (IMPORTANT - capture these!)
- **Turning point**: What discovery led to the solution?
- **Solution**: How was it ultimately solved?
- **Pitfalls**: What traps are easy to fall into?

**If no explicit failures in session**: Supplement with common pitfalls from domain knowledge. The "Failed Attempts" section is valuable even with hypothetical mistakes others commonly make.

### Step 2: Analyze Structure [MUST]

Determine skill type needed (see references/skill-types.md for details):

| Session Pattern | Skill Type |
|-----------------|------------|
| Multi-step workflow with clear phases | SOP Orchestration |
| Reusable code written | Tool Skill |
| Guidance/reasoning task | Capability Skill |
| Complex workflow + helpers | SOP + multiple helpers |

**Check for multi-skill workflow**:
- [ ] 3+ distinct phases?
- [ ] Each phase has clear I/O?
- [ ] Phases useful independently?
- [ ] Sequential/conditional flow?

If 3+ checked -> consider SOP + helper skills.

### Step 3: Assess Freedom Level [MUST]

For each skill to generate:

| Characteristic | Freedom | Form |
|----------------|---------|------|
| Fragile, exact sequence matters | Low | Tool with script |
| Preferred pattern, some variation OK | Medium | SOP with guidance |
| Multiple valid approaches | High | Capability with examples |

### Step 4: Evaluate Worth [CONDITIONAL]

> Skip if user explicitly requested `/distill`

Quick check - suggest distill if ANY:
- User said "finally!", "what a trap", "oh that's why"
- Took 3+ iteration cycles
- Solution was counter-intuitive

For detailed scoring, see references/scoring-criteria.md.

### Step 5: Present Summary [MUST]

Show concise summary (see references/examples.md for format):

```
## Distill Summary

**Problem solved**: <one line>

**What I'll create**:
- `/<skill-name>` - <purpose> [Type]

**Key insights captured**:
- <insight 1>
- <insight 2>

**Failed attempts captured**:
- <what didn't work>

**Where to save**:
- Local (.claude/skills/) or Global (~/.claude/skills/)

Confirm? [Y/n]
```

**DO NOT show**: Scoring breakdown, internal analysis, step-by-step reasoning.

### Step 6: Generate Skill [MUST]

Use appropriate template from references/templates/:
- SOP: references/templates/sop-template.md
- Capability: references/templates/capability-template.md
- Tool: references/templates/tool-template.md

**Critical requirements**:
1. Description must include ALL trigger conditions (not in body)
2. MUST include "Failed Attempts" section - use session failures if any, otherwise common domain pitfalls
3. Keep under 200 lines; split to references/ if larger
4. Verify `depends_on` matches skills referenced in body
5. DO NOT include meta-comments like `*Auto-generated by*`, `*Strategy:*`, `*Type:*` at the end
6. Use imperative form for steps ("Install TypeScript" not "Installing TypeScript")

### Step 7: Save [MUST]

| Characteristic | Location |
|----------------|----------|
| Uses project-specific paths | Local (.claude/skills/) |
| General utility | Global (~/.claude/skills/) |

Create directory structure:
```
<location>/skills/<skill-name>/
├── SKILL.md
├── scripts/     (if Tool skill)
└── references/  (if needed)
```

### Step 8: Offer Share [MUST]

```
Share on dstl.dev?
- [Keep local] (default)
- [Share with team]
- [Share publicly]
```

If sharing, use: `~/.claude/skills/distill/scripts/upload-skill.sh --skill-dir <path>`

---

## Advise Flow

> `/distill advise [topic]` - Search existing knowledge before starting work

### Step 1: Search Skills

1. Scan all skills in `~/.claude/skills/*/SKILL.md` and `.claude/skills/*/SKILL.md`
2. Match `[topic]` against:
   - Skill name
   - Description keywords
   - Common Pitfalls section (if exists)
3. If no topic provided, infer from recent conversation context

### Step 2: Extract Key Insights

For each matched skill, extract:
- Main purpose (from description)
- Key steps or decision points
- Failed attempts / pitfalls (most valuable!)
- Any learned preferences

### Step 3: Present Findings

```
## Relevant Skills for "[topic]"

**Direct matches**:
- `/skill-name` - description (relevance: high/medium)

**Key insights from these skills**:
1. <actionable insight from pitfalls or steps>
2. <another insight>

**Common mistakes to avoid**:
- <from Failed Attempts sections>

Load any for details? [skill name / n]
```

If no matches: "No existing skills match '[topic]'. Proceed with the task, and consider /distill afterward if you discover something valuable."

---

## References

- Skill type definitions: references/skill-types.md
- Templates: references/templates/*.md
- Scoring criteria: references/scoring-criteria.md
- Output examples: references/examples.md
- Upload guide: references/upload-guide.md
